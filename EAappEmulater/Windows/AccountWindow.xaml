<ui:Window
    x:Class="EAappEmulater.Windows.AccountWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://wpf.microsoft.com/ui/2024/xaml"
    xmlns:conv="clr-namespace:ModernWpf.Converters;assembly=ModernWpf"
    x:Name="Window_Account"
    Title="{DynamicResource Windows.AccountWindow.Title}"
    Width="600"
    Height="380"
    CaptionBackground="#FDFDFD"
    Closing="Window_Account_Closing"
    ContentRendered="Window_Account_ContentRendered"
    DataContext="{Binding RelativeSource={RelativeSource Mode=Self}}"
    Icon="/Assets/Icons/Favicon.ico"
    Loaded="Window_Account_Loaded"
    ResizeMode="NoResize"
    Style="{StaticResource CustomSystemWindowStyle}"
    mc:Ignorable="d">

    <ui:Window.Resources>
        <conv:CookieMaskMultiConverter x:Key="CookieMaskMultiConverter" />
    </ui:Window.Resources>

    <ui:Window.TitleContent>
        <DockPanel>
            <StackPanel
                VerticalAlignment="Center"
                DockPanel.Dock="Right"
                Orientation="Horizontal"
                WindowChrome.IsHitTestVisibleInChrome="True">

                <!-- Language ComboBox (compact) -->
                <ComboBox
                    x:Name="ComboBox_Language"
                    Width="110"
                    Height="24"
                    Margin="4,0,10,0"
                    VerticalAlignment="Center"
                    ItemsSource="{Binding LanguageList}"
                    SelectedValuePath="Code"
                    SelectedValue="{Binding CurrentLanguage, Mode=TwoWay}"
                    FontFamily="Segoe UI, Arial"
                    FontSize="12">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Image Width="18" Height="12" Source="{Binding Image}" Margin="0,0,6,0" />
                                <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <ui:IconHyperlink
                    Margin="0,0,7,0"
                    Text="GitHub"
                    ToolTip="https://github.com/CrazyZhang666/EAappEmulater"
                    Uri="https://github.com/CrazyZhang666/EAappEmulater" />
                <ui:WinButton
                    Command="{Binding OpenConfigFolderCommand}"
                    FontSize="14"
                    Icon="&#xE713;"
                    ToolTip="{DynamicResource Windows.AccountWindow.OpenConfig}" />
                <Border
                    Width="1"
                    Height="14"
                    Margin="7,0,7,0"
                    Background="Gray" />
            </StackPanel>
            <StackPanel Orientation="Horizontal">
                <ui:Image
                    Width="18"
                    Height="18"
                    Margin="7,0,0,0"
                    Source="{Binding Icon}" />
                <TextBlock
                    Margin="7,0,0,0"
                    VerticalAlignment="Center"
                    Text="{Binding Title}" />
            </StackPanel>
        </DockPanel>
    </ui:Window.TitleContent>

    <Grid Margin="5">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" d:Width="70" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>

        <DockPanel Grid.Column="0">
            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Margin="5,0,0,5">
                <ui:IconButton
                    Width="46"
                    Height="46"
                    Padding="0"
                    Command="{Binding AddAccountCommand}"
                    Icon="&#xE710;"
                    ToolTip="添加账号配置" />
            </StackPanel>
            <ListBox
                x:Name="ListBox_AccountInfo"
                ItemsSource="{Binding ObsCol_AccountInfos}"
                Style="{StaticResource ListBoxStyle_Avatar}" Cursor="">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <ui:IconFont
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Icon="&#xE948;" />
                            <ui:Avatar
                                Width="46"
                                Height="46"
                                Margin="0,5,5,5"
                                VerticalAlignment="Center"
                                Source="{Binding Avatar}" />
                            <TextBlock
                                Margin="2,7,0,0"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top"
                                d:Text="S0"
                                FontSize="8"
                                Foreground="Gray"
                                Text="{Binding AccountSlot}" />
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </DockPanel>

        <DockPanel Grid.Column="1">
            <StackPanel DockPanel.Dock="Bottom" Height="52" Orientation="Horizontal" Width="506">

                <ui:IconButton
                    Padding="10"
                    Command="{Binding LoginAccountCommand}"
                    Content="{DynamicResource Windows.AccountWindow.LoginAccount}"
                    Icon="&#xE77B;" Width="437" Height="41">
                    <ui:IconButton.Style>
                        <Style BasedOn="{StaticResource IconButtonStyle_Base}" TargetType="{x:Type ui:IconButton}">
                            <Setter Property="IsEnabled" Value="False" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Text, Converter={StaticResource IsNullOrWhiteSpace2Converter}, ElementName=TextBoxHint_Remid}" Value="True" />
                                        <Condition Binding="{Binding Text, Converter={StaticResource IsNullOrWhiteSpace2Converter}, ElementName=TextBoxHint_Sid}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="IsEnabled" Value="True" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ui:IconButton.Style>
                </ui:IconButton>

                <ui:IconButton
                    Margin="6,0,0,0"
                    Width="46"
                    Height="41"
                    Padding="0"
                    Command="{Binding DeleteAccountCommand}"
                    Icon="&#xE74D;"
                    ToolTip="删除当前配置"
                    Background="#FFE57373" />

            </StackPanel>

            <StackPanel DockPanel.Dock="Top">
                <DockPanel>
                    <Grid
                        Width="64"
                        Height="64"
                        Margin="5,5,10,5"
                        DockPanel.Dock="Left">
                        <ui:Avatar
                            BorderThickness="1"
                            Source="{Binding ElementName=ListBox_AccountInfo, Path=SelectedItem.Avatar}"
                            ToolTip="{Binding ElementName=ListBox_AccountInfo, Path=SelectedItem.AvatarId}" />
                        <TextBlock
                            Margin="5"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            d:Text="S0"
                            FontSize="10"
                            Foreground="Gray"
                            Text="{Binding ElementName=ListBox_AccountInfo, Path=SelectedItem.AccountSlot}" />
                    </Grid>
                    <DockPanel>
                        <WrapPanel DockPanel.Dock="Bottom">
                            <ui:IconButton
                                Margin="0,0,5,5"
                                Command="{Binding GetCookieCommand}"
                                Content="{DynamicResource Windows.AccountWindow.GetCookie}"
                                Icon="&#xE72C;" />
                            <ui:IconButton
                                Margin="0,0,5,5"
                                Command="{Binding ChangeAccountCommand}"
                                Content="{DynamicResource Windows.AccountWindow.ChangeAccount}"
                                Icon="&#xE8FA;" />
                            <ToggleButton Margin="0,0,5,5" IsChecked="{Binding ShowCookie}" Content="显示Cookie" />
                        </WrapPanel>
                        <TextBlock
                            VerticalAlignment="Center"
                            d:Text="PlayerName"
                            FontSize="20"
                            FontWeight="Bold"
                            Text="{Binding ElementName=ListBox_AccountInfo, Path=SelectedItem.PlayerName}" />
                    </DockPanel>
                </DockPanel>

                <ui:IconHeader Title="Remid" />
                <DockPanel>
                    <ui:TextBoxHint
                        x:Name="TextBoxHint_Remid"
                        Height="70"
                        Hint="{DynamicResource Windows.AccountWindow.ShowRemid}"
                        Style="{StaticResource TextBoxHintStyle_MultiLine}" Width="457">
                        <ui:TextBoxHint.Text>
                            <MultiBinding Converter="{StaticResource CookieMaskMultiConverter}">
                                <Binding ElementName="ListBox_AccountInfo" Path="SelectedItem.Remid" />
                                <Binding Path="ShowCookie" />
                            </MultiBinding>
                        </ui:TextBoxHint.Text>
                    </ui:TextBoxHint>
                    <ui:IconButton
                        Margin="5,0,0,0"
                        Command="{Binding CopyRemidCommand}"
                        Icon="&#xE8C8;"
                        ToolTip="复制 Remid" Height="70" Width="42" />
                </DockPanel>

                <ui:IconHeader Title="Sid" />
                <DockPanel>
                    <ui:TextBoxHint
                        x:Name="TextBoxHint_Sid"
                        Height="70"
                        Hint="{DynamicResource Windows.AccountWindow.ShowSid}"
                        Style="{StaticResource TextBoxHintStyle_MultiLine}" Width="457">
                        <ui:TextBoxHint.Text>
                            <MultiBinding Converter="{StaticResource CookieMaskMultiConverter}">
                                <Binding ElementName="ListBox_AccountInfo" Path="SelectedItem.Sid" />
                                <Binding Path="ShowCookie" />
                            </MultiBinding>
                        </ui:TextBoxHint.Text>
                    </ui:TextBoxHint>
                    <ui:IconButton
                        Margin="5,0,0,0"
                        Command="{Binding CopySidCommand}"
                        Icon="&#xE8C8;"
                        ToolTip="复制 Sid" Width="42" Height="70" />
                </DockPanel>

            </StackPanel>
        </DockPanel>

    </Grid>

</ui:Window>
